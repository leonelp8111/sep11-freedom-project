1<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <script type="module">

            // import kaboom lib
            import kaboom from "https://unpkg.com/kaboom@3000.0.1/dist/kaboom.mjs";

            kaboom({

  background: [141, 183, 255],

})

loadSprite("spiderman", "sprites/spiderman.jpeg")
const spider = add([
  sprite("spiderman"),
  pos(100, 10),
  area({scale:0.9}),
  body(),
  // health(5),
  scale(0.2),
])
loadSprite("block", "/sprites/marioblock.jpeg")
loadSprite("spike", "/sprites/spike.png")
loadSprite("coin", "/sprites/coin.png")
loadSound("score", "/sounds/score.mp3")
loadSprite("alien", "/sprites/alien.jpg")
const enemy = add([
  sprite("alien"),
  pos(0, 0),
  area(),
  anchor("center"),
  ])

const SPEED = 480
const FALL_DEATH = 2400
const ENEMY_SPEED = 160
setGravity(1100)
const BULLET_SPEED = 1200

function patrol(speed = 60, dir = 1) {
  return {
    id: "patrol",
    require: [ "pos", "area" ],
    add() {
      this.on("collide", (obj, col) => {
        if (col.isLeft() || col.isRight()) {
          dir = -dir
        }
      })
    },
    update() {
      this.move(speed * dir, 0)
    },
  }
}


const level = addLevel([
        "@  ^^  $$     >        ^   $$       > >  ",
        "=========  ======  ===========  =========",
      ], {

        tileWidth: 110,
        tileHeight: 32,
        pos: vec2(90, 600),
        tiles: {
          "@": () => [

            // sprite("spiderman"),
            // area(),
            // body(),
            // anchor("bot"),
            // "spider",
          ],
          "=": () => [
            sprite("block"),
            area(),
            body({ isStatic: true }),
            anchor("bot"),
            scale(0.3),
          ],
          "^": () => [
            sprite("spike"),
            area({scale:0.5}),
            anchor("bot"),
            "danger",
            scale(0.4),
          ],
          "$": () => [
            sprite("coin"),
            area(),
            anchor("bot"),
            "coin",
            scale(0.5),
          ],
          ">": () => [
            sprite("alien"),
            area(),
            anchor("bot"),
            body(),
            patrol(),
            offscreen({ hide: true }),
            "enemy",
          ],
        },
      })

      const player = level.get("spider")[0]

      // Movements
      onKeyPress("w", () => {
        if (spider.isGrounded()) {
          spider.jump()
        }
      })

      onKeyDown("a", () => {
        spider.move(-SPEED, 0)
      })

      onKeyDown("d", () => {
        spider.move(SPEED, 0)
      })

      spider.onCollide("danger", () => {
        spider.pos = level.tile2Pos(0, 0)
      })

      spider.onCollide("coin", (coin) => {
        destroy(coin)
        play("score")
        // score++
        // scoreLabel.text = score
      })

      spider.onUpdate(() => {
        camPos(spider.pos)
      })

      function spawnBullet(p) {
        add([
          rect(12, 48),
          area(),
          pos(p),
          anchor("center"),
          color(127, 127, 255),
          outline(4),
          move(RIGHT, BULLET_SPEED),
          offscreen({ destroy: true }),
          "bullet",
        ])
      }

      onKeyPress("m", () => {
        spawnBullet(spider.pos.sub(16, 0))
        spawnBullet(spider.pos.add(16, 0))
      })

enemy.onCollide("bullet", (bullet) => {
  destroy(bullet)
  destroy(enemy)
  addKaboom(bullet.pos)
})

if (spider.pos.y >= FALL_DEATH) {
  spider.pos = level.tile2Pos(0, 0)
}


            </script>
        <style>
            /* CSS */

        </style>

        <title>Kaboom</title>
    </head>
    <body>
        <!-- HTML -->


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // JS


        </script>
    </body>
</html>
